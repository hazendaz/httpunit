<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JavaScript.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">httpunit</a> &gt; <a href="index.source.html" class="el_package">com.meterware.httpunit.javascript</a> &gt; <span class="el_source">JavaScript.java</span></div><h1>JavaScript.java</h1><pre class="source lang-java linenums">/*
 * MIT License
 *
 * Copyright 2011-2025 Russell Gold
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and
 * to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
 * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
 * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 */
package com.meterware.httpunit.javascript;

import com.meterware.httpunit.ClientProperties;
import com.meterware.httpunit.HTMLPage;
import com.meterware.httpunit.HttpUnitOptions;
import com.meterware.httpunit.HttpUnitUtils;
import com.meterware.httpunit.WebForm;
import com.meterware.httpunit.WebImage;
import com.meterware.httpunit.WebLink;
import com.meterware.httpunit.WebResponse;
import com.meterware.httpunit.javascript.events.EventException;
import com.meterware.httpunit.javascript.events.EventTarget;
import com.meterware.httpunit.scripting.DocumentElement;
import com.meterware.httpunit.scripting.FormScriptable;
import com.meterware.httpunit.scripting.IdentifiedDelegate;
import com.meterware.httpunit.scripting.Input;
import com.meterware.httpunit.scripting.NamedDelegate;
import com.meterware.httpunit.scripting.ScriptableDelegate;
import com.meterware.httpunit.scripting.ScriptingEngine;
import com.meterware.httpunit.scripting.ScriptingHandler;
import com.meterware.httpunit.scripting.SelectionOption;
import com.meterware.httpunit.scripting.SelectionOptions;

import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.net.URL;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import org.mozilla.javascript.Context;
import org.mozilla.javascript.EvaluatorException;
import org.mozilla.javascript.JavaScriptException;
import org.mozilla.javascript.Scriptable;
import org.mozilla.javascript.ScriptableObject;
import org.mozilla.javascript.Undefined;
import org.xml.sax.SAXException;

/**
 * This class is the Rhino-compatible implementation of the JavaScript DOM objects.
 *
 * @author &lt;a href=&quot;mailto:russgold@httpunit.org&quot;&gt;Russell Gold&lt;/a&gt;
 **/
<span class="nc" id="L64">public class JavaScript {</span>

<span class="fc" id="L66">    private static boolean _throwExceptionsOnError = true;</span>

    public static boolean isThrowExceptionsOnError() {
<span class="fc" id="L69">        return _throwExceptionsOnError;</span>
    }

    public static void setThrowExceptionsOnError(boolean throwExceptionsOnError) {
<span class="fc" id="L73">        _throwExceptionsOnError = throwExceptionsOnError;</span>
<span class="fc" id="L74">    }</span>

    /**
     * Initiates JavaScript execution for the specified web response.
     */
    public static void run(WebResponse response) throws IllegalAccessException, InstantiationException,
            InvocationTargetException, EvaluatorException, EvaluatorException, SAXException, JavaScriptException {
<span class="fc" id="L81">        Context context = Context.enter();</span>
        // suggest bug fix for large java scripts see
        // bug report [ 1216567 ] Exception for large javascripts
        // by Grzegorz Lukasik
        // and

<span class="fc" id="L87">        context.setOptimizationLevel(HttpUnitOptions.getJavaScriptOptimizationLevel());</span>
<span class="fc" id="L88">        Scriptable scope = context.initStandardObjects(null);</span>
<span class="fc" id="L89">        initHTMLObjects(scope);</span>

<span class="fc" id="L91">        Window w = (Window) context.newObject(scope, &quot;Window&quot;);</span>
<span class="fc" id="L92">        w.initialize(null, response.getScriptableObject());</span>
<span class="fc" id="L93">    }</span>

    /**
     * Runs the onload event for the specified web response.
     */
    public static void load(WebResponse response) throws EvaluatorException, InstantiationException,
            IllegalAccessException, InvocationTargetException, JavaScriptException, SAXException, EvaluatorException {
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">        if (!(response.getScriptableObject().getScriptEngine() instanceof JavaScriptEngine)) {</span>
<span class="nc" id="L101">            run(response);</span>
        }
<span class="fc" id="L103">        response.getScriptableObject().load();</span>
<span class="fc" id="L104">    }</span>

    private static void initHTMLObjects(Scriptable scope)
            throws IllegalAccessException, InstantiationException, InvocationTargetException, EvaluatorException {
<span class="fc" id="L108">        ScriptableObject.defineClass(scope, Window.class);</span>
<span class="fc" id="L109">        ScriptableObject.defineClass(scope, Document.class);</span>
<span class="fc" id="L110">        ScriptableObject.defineClass(scope, Style.class);</span>
<span class="fc" id="L111">        ScriptableObject.defineClass(scope, Location.class);</span>
<span class="fc" id="L112">        ScriptableObject.defineClass(scope, Navigator.class);</span>
<span class="fc" id="L113">        ScriptableObject.defineClass(scope, Screen.class);</span>
<span class="fc" id="L114">        ScriptableObject.defineClass(scope, Link.class);</span>
<span class="fc" id="L115">        ScriptableObject.defineClass(scope, Form.class);</span>
<span class="fc" id="L116">        ScriptableObject.defineClass(scope, Control.class);</span>
<span class="fc" id="L117">        ScriptableObject.defineClass(scope, Link.class);</span>
<span class="fc" id="L118">        ScriptableObject.defineClass(scope, Image.class);</span>
<span class="fc" id="L119">        ScriptableObject.defineClass(scope, Options.class);</span>
<span class="fc" id="L120">        ScriptableObject.defineClass(scope, Option.class);</span>
<span class="fc" id="L121">        ScriptableObject.defineClass(scope, ElementArray.class);</span>
<span class="fc" id="L122">        ScriptableObject.defineClass(scope, HTMLElement.class);</span>
<span class="fc" id="L123">    }</span>

    /**
     * abstract Engine for JavaScript
     */
<span class="fc" id="L128">    abstract static class JavaScriptEngine extends ScriptingEngineImpl implements EventTarget {</span>

        private static final long serialVersionUID = 1L;
        protected ScriptableDelegate _scriptable;
        protected JavaScriptEngine _parent;
<span class="fc" id="L133">        protected Map _eventListeners = new HashMap&lt;&gt;(); // Map&lt;String,Set&lt;EventListener&gt;&gt;</span>
<span class="fc" id="L134">        protected Map _eventCaptureListeners = new HashMap&lt;&gt;(); // Map&lt;String,Set&lt;EventListener&gt;&gt;</span>

        /**
         * initialize JavaScript for the given ScriptEngine
         *
         * @parent - the Script Engine to use
         *
         * @scriptable - the scriptable object to do the initialization for
         */
        void initialize(JavaScriptEngine parent, ScriptableDelegate scriptable)
                throws SAXException, JavaScriptException, EvaluatorException {
<span class="fc" id="L145">            _scriptable = scriptable;</span>
<span class="fc" id="L146">            _scriptable.setScriptEngine(this);</span>
<span class="fc" id="L147">            _parent = parent;</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">            if (parent != null) {</span>
<span class="fc" id="L149">                setParentScope(parent);</span>
            }
<span class="fc" id="L151">        }</span>

        String getName() {
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">            return _scriptable instanceof NamedDelegate ? ((NamedDelegate) _scriptable).getName() : &quot;&quot;;</span>
        }

        String getID() {
<span class="fc bfc" id="L158" title="All 2 branches covered.">            return _scriptable instanceof IdentifiedDelegate ? ((IdentifiedDelegate) _scriptable).getID() : &quot;&quot;;</span>
        }

        /**
         * get the event Handler script for the event e.g. onchange, onmousedown, onclick, onmouseup execute the script
         * if it's assigned by calling doEvent for the script
         *
         * @param eventName
         *
         * @return
         */
        @Override
        public boolean handleEvent(String eventName) {
<span class="nc" id="L171">            return _scriptable.handleEvent(eventName);</span>
        }

        @Override
        public boolean has(String propertyName, Scriptable scriptable) {
<span class="fc bfc" id="L176" title="All 6 branches covered.">            return super.has(propertyName, scriptable) || _scriptable != null &amp;&amp; _scriptable.get(propertyName) != null;</span>
        }

        @Override
        public Object get(String propertyName, Scriptable scriptable) {
<span class="fc" id="L181">            Object result = super.get(propertyName, scriptable);</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">            if (result != NOT_FOUND) {</span>
<span class="fc" id="L183">                return result;</span>
            }
<span class="fc bfc" id="L185" title="All 2 branches covered.">            if (_scriptable == null) {</span>
<span class="fc" id="L186">                return NOT_FOUND;</span>
            }

<span class="fc" id="L189">            return convertIfNeeded(_scriptable.get(propertyName));</span>

        }

        @Override
        public Object get(int i, Scriptable scriptable) {
<span class="fc" id="L195">            Object result = super.get(i, scriptable);</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">            if (result != NOT_FOUND) {</span>
<span class="nc" id="L197">                return result;</span>
            }
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">            if (_scriptable == null) {</span>
<span class="nc" id="L200">                return NOT_FOUND;</span>
            }

<span class="fc" id="L203">            return convertIfNeeded(_scriptable.get(i));</span>
        }

        private Object convertIfNeeded(final Object property) {
<span class="fc bfc" id="L207" title="All 2 branches covered.">            if (property == null) {</span>
<span class="fc" id="L208">                return NOT_FOUND;</span>
            }

<span class="fc bfc" id="L211" title="All 2 branches covered.">            if (property instanceof ScriptableDelegate[]) {</span>
<span class="fc" id="L212">                return toScriptable((ScriptableDelegate[]) property);</span>
            }
<span class="fc bfc" id="L214" title="All 2 branches covered.">            if (!(property instanceof ScriptableDelegate)) {</span>
<span class="fc" id="L215">                return property;</span>
            }
<span class="fc" id="L217">            return toScriptable((ScriptableDelegate) property);</span>
        }

        private Object toScriptable(ScriptableDelegate[] list) {
<span class="fc" id="L221">            Object[] delegates = new Object[list.length];</span>
<span class="fc bfc" id="L222" title="All 2 branches covered.">            for (int i = 0; i &lt; delegates.length; i++) {</span>
<span class="fc" id="L223">                delegates[i] = toScriptable(list[i]);</span>
            }
<span class="fc" id="L225">            return Context.getCurrentContext().newArray(this, delegates);</span>
        }

        @Override
        public void put(String propertyName, Scriptable scriptable, Object value) {
<span class="fc bfc" id="L230" title="All 4 branches covered.">            if (_scriptable == null || _scriptable.get(propertyName) == null) {</span>
<span class="fc" id="L231">                super.put(propertyName, scriptable, value);</span>
            } else {
<span class="fc" id="L233">                _scriptable.set(propertyName, value);</span>
            }
<span class="fc" id="L235">        }</span>

        @Override
        public String toString() {
<span class="nc bnc" id="L239" title="All 2 branches missed.">            return (_scriptable == null ? &quot;prototype &quot; : &quot;&quot;) + getClassName();</span>
        }

        @Override
        public ScriptingEngine newScriptingEngine(ScriptableDelegate child) {
            try {
<span class="fc" id="L245">                return (ScriptingEngine) toScriptable(child);</span>
<span class="nc" id="L246">            } catch (Exception e) {</span>
<span class="nc" id="L247">                HttpUnitUtils.handleException(e);</span>
<span class="nc" id="L248">                throw new RuntimeException(e.toString());</span>
            }
        }

        @Override
        public void clearCaches() {
<span class="nc" id="L254">        }</span>

        protected static String toStringIfNotUndefined(Object object) {
<span class="pc bpc" id="L257" title="1 of 4 branches missed.">            return object == null || Undefined.instance.equals(object) ? null : object.toString();</span>
        }

        /**
         * Converts a scriptable delegate obtained from a subobject into the appropriate Rhino-compatible Scriptable.
         **/
        final Object toScriptable(ScriptableDelegate delegate) {
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">            if (delegate == null) {</span>
<span class="nc" id="L265">                return NOT_FOUND;</span>
            }
<span class="fc bfc" id="L267" title="All 2 branches covered.">            if (delegate.getScriptEngine() instanceof Scriptable) {</span>
<span class="fc" id="L268">                return delegate.getScriptEngine();</span>
            }
            try {
<span class="fc" id="L271">                JavaScriptEngine element = (JavaScriptEngine) Context.getCurrentContext().newObject(this,</span>
<span class="fc" id="L272">                        getScriptableClassName(delegate));</span>
<span class="fc" id="L273">                element.initialize(this, delegate);</span>
<span class="fc" id="L274">                return element;</span>
<span class="nc" id="L275">            } catch (RuntimeException e) {</span>
<span class="nc" id="L276">                throw e;</span>
<span class="nc" id="L277">            } catch (Exception e) {</span>
<span class="nc" id="L278">                throw new RhinoException(e);</span>
            }
        }

        /**
         * get the classname of the given ScriptableDelegate
         *
         * @param delegate
         *            - the object to get the class name for
         *
         * @return - the simple local class name for the delegate e.g. Window, Document, Form, Link, Image, Options,
         *         Option, Control, HTMLElement
         *
         * @throws an
         *             IllegalArgumentException if the delegate is not known
         */
        private String getScriptableClassName(ScriptableDelegate delegate) {
<span class="fc bfc" id="L295" title="All 2 branches covered.">            if (delegate instanceof WebResponse.Scriptable) {</span>
<span class="fc" id="L296">                return &quot;Window&quot;;</span>
            }
<span class="fc bfc" id="L298" title="All 2 branches covered.">            if (delegate instanceof HTMLPage.Scriptable) {</span>
<span class="fc" id="L299">                return &quot;Document&quot;;</span>
            }
<span class="fc bfc" id="L301" title="All 2 branches covered.">            if (delegate instanceof FormScriptable) {</span>
<span class="fc" id="L302">                return &quot;Form&quot;;</span>
            }
<span class="fc bfc" id="L304" title="All 2 branches covered.">            if (delegate instanceof WebLink.Scriptable) {</span>
<span class="fc" id="L305">                return &quot;Link&quot;;</span>
            }
<span class="fc bfc" id="L307" title="All 2 branches covered.">            if (delegate instanceof WebImage.Scriptable) {</span>
<span class="fc" id="L308">                return &quot;Image&quot;;</span>
            }
<span class="fc bfc" id="L310" title="All 2 branches covered.">            if (delegate instanceof SelectionOptions) {</span>
<span class="fc" id="L311">                return &quot;Options&quot;;</span>
            }
<span class="fc bfc" id="L313" title="All 2 branches covered.">            if (delegate instanceof SelectionOption) {</span>
<span class="fc" id="L314">                return &quot;Option&quot;;</span>
            }
<span class="fc bfc" id="L316" title="All 2 branches covered.">            if (delegate instanceof Input) {</span>
<span class="fc" id="L317">                return &quot;Control&quot;;</span>
            }
<span class="pc bpc" id="L319" title="1 of 2 branches missed.">            if (delegate instanceof DocumentElement) {</span>
<span class="fc" id="L320">                return &quot;HTMLElement&quot;;</span>
            }

<span class="nc" id="L323">            throw new IllegalArgumentException(&quot;Unknown ScriptableDelegate class: &quot; + delegate.getClass());</span>
        }

        protected ElementArray toElementArray(ScriptingHandler[] scriptables) {
<span class="fc" id="L327">            JavaScriptEngine[] elements = new JavaScriptEngine[scriptables.length];</span>
<span class="fc bfc" id="L328" title="All 2 branches covered.">            for (int i = 0; i &lt; elements.length; i++) {</span>
<span class="fc" id="L329">                elements[i] = (JavaScriptEngine) toScriptable((ScriptableDelegate) scriptables[i]);</span>
            }
<span class="fc" id="L331">            ElementArray result = ElementArray.newElementArray(this);</span>
<span class="fc" id="L332">            result.initialize(elements);</span>
<span class="fc" id="L333">            return result;</span>
        }

        /**
         * {@inheritDoc}
         */
        @Override
        public void jsFunction_addEventListener(String type, Scriptable listener, boolean useCapture) {
<span class="nc bnc" id="L341" title="All 2 branches missed.">            if (useCapture) {</span>
<span class="nc" id="L342">                Set set = (Set) _eventCaptureListeners.get(type); // Set&lt;Scriptable&gt;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                if (set == null) {</span>
<span class="nc" id="L344">                    set = new HashSet&lt;&gt;();</span>
<span class="nc" id="L345">                    _eventCaptureListeners.put(type, set);</span>
                }
<span class="nc" id="L347">                set.add(listener);</span>
<span class="nc" id="L348">            } else {</span>
<span class="nc" id="L349">                Set set = (Set) _eventListeners.get(type); // Set&lt;Scriptable&gt;</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">                if (set == null) {</span>
<span class="nc" id="L351">                    set = new HashSet&lt;&gt;();</span>
<span class="nc" id="L352">                    _eventListeners.put(type, set);</span>
                }
<span class="nc" id="L354">                set.add(listener);</span>
            }
            // System.out.println(getClassName()+&quot;.addEventListener(&quot;+type+&quot;)&quot;);
<span class="nc" id="L357">        }</span>

        /**
         * {@inheritDoc}
         */
        @Override
        public boolean jsFunction_dispatchEvent(Scriptable evt) throws EventException {
            // TODO implement event dispatching &amp; listener invocation
            // System.out.println(getClassName()+&quot;.dispatchEvent(&quot;+evt.get(&quot;type&quot;,evt)+&quot;)&quot;);
<span class="nc" id="L366">            return true;</span>
        }

        /**
         * {@inheritDoc}
         */
        @Override
        public void jsFunction_removeEventListener(String type, Scriptable listener, boolean useCapture) {
<span class="nc bnc" id="L374" title="All 2 branches missed.">            if (useCapture) {</span>
<span class="nc" id="L375">                Set set = (Set) _eventCaptureListeners.get(type); // Set&lt;EventListener&gt;</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">                if (set != null) {</span>
<span class="nc" id="L377">                    set.remove(listener);</span>
                }
<span class="nc" id="L379">            } else {</span>
<span class="nc" id="L380">                Set set = (Set) _eventListeners.get(type); // Set&lt;EventListener&gt;</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">                if (set != null) {</span>
<span class="nc" id="L382">                    set.remove(listener);</span>
                }
            }
            // System.out.println(getClassName()+&quot;.removeEventListener(&quot;+type+&quot;)&quot;);
<span class="nc" id="L386">        }</span>
    }

    /**
     * Window functions
     */
<span class="fc" id="L392">    static public class Window extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private Document _document;
        private Navigator _navigator;
        private Location _location;
        private Screen _screen;
        private ElementArray _frames;

        @Override
        public String getClassName() {
<span class="fc" id="L403">            return &quot;Window&quot;;</span>
        }

        public Window jsGet_window() {
<span class="fc" id="L407">            return this;</span>
        }

        public Window jsGet_self() {
<span class="nc" id="L411">            return this;</span>
        }

        public Document jsGet_document() {
<span class="fc bfc" id="L415" title="All 2 branches covered.">            if (_document == null) {</span>
<span class="fc" id="L416">                _document = (Document) toScriptable(getDelegate().getDocument());</span>
            }
<span class="fc" id="L418">            return _document;</span>
        }

        public Scriptable jsGet_frames() throws SAXException, JavaScriptException, EvaluatorException {
<span class="fc bfc" id="L422" title="All 2 branches covered.">            if (_frames == null) {</span>
<span class="fc" id="L423">                WebResponse.Scriptable[] scriptables = getDelegate().getFrames();</span>
<span class="fc" id="L424">                Window[] frames = new Window[scriptables.length];</span>
<span class="fc bfc" id="L425" title="All 2 branches covered.">                for (int i = 0; i &lt; frames.length; i++) {</span>
<span class="fc" id="L426">                    frames[i] = (Window) toScriptable(scriptables[i]);</span>
                }
<span class="fc" id="L428">                _frames = (ElementArray) Context.getCurrentContext().newObject(this, &quot;ElementArray&quot;);</span>
<span class="fc" id="L429">                _frames.initialize(frames);</span>
            }
<span class="fc" id="L431">            return _frames;</span>
        }

        public Navigator jsGet_navigator() {
<span class="fc" id="L435">            return _navigator;</span>
        }

        public Screen jsGet_screen() {
<span class="fc" id="L439">            return _screen;</span>
        }

        public Location jsGet_location() {
<span class="fc" id="L443">            return _location;</span>
        }

        public void jsSet_location(String relativeURL) throws IOException, SAXException {
<span class="fc" id="L447">            setLocation(relativeURL);</span>
<span class="fc" id="L448">        }</span>

        void setLocation(String relativeURL) throws IOException, SAXException {
<span class="fc" id="L451">            getDelegate().setLocation(relativeURL);</span>
<span class="fc" id="L452">        }</span>

        /**
         * initialize JavaScript for the given ScriptEngine
         *
         * @parent - the Script Engine to use
         *
         * @scriptable - the scriptable object to do the initialization for
         */
        @Override
        void initialize(JavaScriptEngine parent, ScriptableDelegate scriptable)
                throws JavaScriptException, EvaluatorException, SAXException {
<span class="fc" id="L464">            super.initialize(parent, scriptable);</span>

<span class="fc" id="L466">            _location = (Location) Context.getCurrentContext().newObject(this, &quot;Location&quot;);</span>
<span class="fc" id="L467">            _location.initialize(this, ((WebResponse.Scriptable) scriptable).getURL());</span>

<span class="fc" id="L469">            _navigator = (Navigator) Context.getCurrentContext().newObject(this, &quot;Navigator&quot;);</span>
<span class="fc" id="L470">            _navigator.setClientProperties(getDelegate().getClientProperties());</span>

<span class="fc" id="L472">            _screen = (Screen) Context.getCurrentContext().newObject(this, &quot;Screen&quot;);</span>
<span class="fc" id="L473">            _screen.setClientProperties(getDelegate().getClientProperties());</span>
<span class="fc" id="L474">        }</span>

        /**
         * javascript alert handling
         *
         * @param message
         *            - the alert message
         */
        public void jsFunction_alert(String message) {
<span class="fc" id="L483">            getDelegate().alertUser(message);</span>
<span class="fc" id="L484">        }</span>

        /**
         * javascript built in function &quot;toLowerCase&quot;
         *
         * @param s
         */
        public String jsFunction_toLowerCase(String s) {
<span class="fc" id="L492">            return s.toLowerCase();</span>
        }

        public boolean jsFunction_confirm(String message) {
<span class="fc" id="L496">            return getDelegate().getConfirmationResponse(message);</span>
        }

        public String jsFunction_prompt(String message, String defaultResponse) {
<span class="fc" id="L500">            return getDelegate().getUserResponse(message, defaultResponse);</span>
        }

        public void jsFunction_moveTo(int x, int y) {
<span class="nc" id="L504">        }</span>

        public void jsFunction_scrollTo(int x, int y) {
<span class="nc" id="L507">        }</span>

        public void jsFunction_focus() {
<span class="nc" id="L510">        }</span>

        public void jsFunction_setTimeout() {
<span class="nc" id="L513">        }</span>

        public void jsFunction_close() {
<span class="fc" id="L516">            getDelegate().closeWindow();</span>
<span class="fc" id="L517">        }</span>

        public Window jsFunction_open(Object url, String name, String features, boolean replace)
                throws JavaScriptException, EvaluatorException, IOException, SAXException {
<span class="fc" id="L521">            WebResponse.Scriptable delegate = getDelegate().open(toStringIfNotUndefined(url), name, features, replace);</span>
<span class="fc bfc" id="L522" title="All 2 branches covered.">            return delegate == null ? null : (Window) toScriptable(delegate);</span>
        }

        /** The global &quot;event&quot; object is not supported, so return null (instead of causing '&quot;event&quot; is not defined') */
        public Location jsGet_event() {
<span class="nc" id="L527">            return null;</span>
        }

        @Override
        public void clearCaches() {
<span class="fc bfc" id="L532" title="All 2 branches covered.">            if (_document != null) {</span>
<span class="fc" id="L533">                _document.clearCaches();</span>
            }
<span class="fc" id="L535">        }</span>

        @Override
        protected String getDocumentWriteBuffer() {
<span class="fc" id="L539">            return jsGet_document().getWriteBuffer().toString();</span>
        }

        @Override
        protected void discardDocumentWriteBuffer() {
<span class="fc" id="L544">            jsGet_document().clearWriteBuffer();</span>
<span class="fc" id="L545">        }</span>

        private WebResponse.Scriptable getDelegate() {
<span class="fc" id="L548">            return (WebResponse.Scriptable) _scriptable;</span>
        }
    }

    /**
     * Document script handling
     */
<span class="fc" id="L555">    static public class Document extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private ElementArray _forms;
        private ElementArray _links;
        private ElementArray _images;
        private StringBuilder _writeBuffer;
        private String _mimeType;

        @Override
        public String getClassName() {
<span class="fc" id="L566">            return &quot;Document&quot;;</span>
        }

        @Override
        public void clearCaches() {
<span class="fc" id="L571">            _forms = _links = _images = null;</span>
<span class="fc" id="L572">        }</span>

        public String jsGet_title() throws SAXException {
<span class="fc" id="L575">            return getDelegate().getTitle();</span>
        }

        public Scriptable jsGet_images() throws SAXException {
<span class="fc bfc" id="L579" title="All 2 branches covered.">            if (_images == null) {</span>
<span class="fc" id="L580">                _images = toElementArray(getDelegate().getImages());</span>
            }
<span class="fc" id="L582">            return _images;</span>
        }

        public Scriptable jsGet_links() throws SAXException {
<span class="fc bfc" id="L586" title="All 2 branches covered.">            if (_links == null) {</span>
<span class="fc" id="L587">                _links = toElementArray(getDelegate().getLinks());</span>
            }
<span class="fc" id="L589">            return _links;</span>
        }

        public Scriptable jsGet_forms() throws SAXException {
<span class="fc bfc" id="L593" title="All 2 branches covered.">            if (_forms == null) {</span>
<span class="fc" id="L594">                _forms = toElementArray(getDelegate().getForms());</span>
            }
<span class="fc" id="L596">            return _forms;</span>
        }

        public Object jsFunction_getElementById(String id) {
<span class="fc" id="L600">            ScriptableDelegate elementWithID = getDelegate().getElementWithID(id);</span>
<span class="fc bfc" id="L601" title="All 2 branches covered.">            return elementWithID == null ? null : toScriptable(elementWithID);</span>
        }

        public Object jsFunction_getElementsByName(String name) {
<span class="fc" id="L605">            return toElementArray(getDelegate().getElementsByName(name));</span>
        }

        public Object jsFunction_getElementsByTagName(String name) {
<span class="fc" id="L609">            return toElementArray(getDelegate().getElementsByTagName(name));</span>
        }

        public Object jsGet_location() {
<span class="pc bpc" id="L613" title="1 of 2 branches missed.">            return _parent == null ? NOT_FOUND : getWindow().jsGet_location();</span>
        }

        public void jsSet_location(String urlString) throws IOException, SAXException {
<span class="pc bpc" id="L617" title="1 of 2 branches missed.">            if (urlString.startsWith(&quot;color&quot;)) {</span>
<span class="nc" id="L618">                return;</span>
            }
<span class="fc" id="L620">            getWindow().setLocation(urlString);</span>
<span class="fc" id="L621">        }</span>

        public String jsGet_cookie() {
<span class="fc" id="L624">            return getDelegate().getCookie();</span>
        }

        public void jsSet_cookie(String cookieSpec) {
<span class="fc" id="L628">            final int equalsIndex = cookieSpec.indexOf('=');</span>
<span class="fc bfc" id="L629" title="All 2 branches covered.">            if (equalsIndex &lt; 0) {</span>
<span class="fc" id="L630">                return;</span>
            }
<span class="fc" id="L632">            int endIndex = cookieSpec.indexOf(&quot;;&quot;, equalsIndex);</span>
<span class="pc bpc" id="L633" title="1 of 2 branches missed.">            if (endIndex &lt; 0) {</span>
<span class="nc" id="L634">                endIndex = cookieSpec.length();</span>
            }
<span class="fc" id="L636">            String name = cookieSpec.substring(0, equalsIndex);</span>
<span class="fc" id="L637">            String value = cookieSpec.substring(equalsIndex + 1, endIndex);</span>
<span class="fc" id="L638">            getDelegate().setCookie(name, value);</span>
<span class="fc" id="L639">        }</span>

        private Window getWindow() {
<span class="fc" id="L642">            return (Window) _parent;</span>
        }

        public void jsFunction_open(Object mimeType) {
<span class="fc" id="L646">            _mimeType = toStringIfNotUndefined(mimeType);</span>
<span class="fc" id="L647">        }</span>

        public void jsFunction_close() {
<span class="fc bfc" id="L650" title="All 4 branches covered.">            if (getDelegate().replaceText(getWriteBuffer().toString(), _mimeType == null ? &quot;text/html&quot; : _mimeType)) {</span>
<span class="fc" id="L651">                getWriteBuffer().setLength(0);</span>
            }
<span class="fc" id="L653">        }</span>

        public void jsFunction_write(String string) {
<span class="fc" id="L656">            getWriteBuffer().append(string);</span>
<span class="fc" id="L657">        }</span>

        public void jsFunction_writeln(String string) {
<span class="fc" id="L660">            getWriteBuffer().append(string).append((char) 0x0D).append((char) 0x0A);</span>
<span class="fc" id="L661">        }</span>

        protected StringBuilder getWriteBuffer() {
<span class="fc bfc" id="L664" title="All 2 branches covered.">            if (_writeBuffer == null) {</span>
<span class="fc" id="L665">                _writeBuffer = new StringBuilder();</span>
            }
<span class="fc" id="L667">            return _writeBuffer;</span>
        }

        protected void clearWriteBuffer() {
<span class="fc" id="L671">            _writeBuffer = null;</span>
<span class="fc" id="L672">        }</span>

        private HTMLPage.Scriptable getDelegate() {
<span class="fc" id="L675">            return (HTMLPage.Scriptable) _scriptable;</span>
        }

        @Override
        public void jsFunction_addEventListener(String type, Scriptable listener, boolean useCapture) {
            // TODO Auto-generated method stub

<span class="nc" id="L682">        }</span>

        @Override
        public boolean jsFunction_dispatchEvent(Scriptable evt) throws EventException {
            // TODO Auto-generated method stub
<span class="nc" id="L687">            return false;</span>
        }

        @Override
        public void jsFunction_removeEventListener(String type, Scriptable listener, boolean useCapture) {
            // TODO Auto-generated method stub

<span class="nc" id="L694">        }</span>

    }

<span class="fc" id="L698">    static public class Location extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private URL _url;
        private Window _window;

        @Override
        public String getClassName() {
<span class="fc" id="L706">            return &quot;Location&quot;;</span>
        }

        void initialize(Window window, URL url) {
<span class="fc" id="L710">            _window = window;</span>
<span class="fc" id="L711">            _url = url;</span>
<span class="fc" id="L712">        }</span>

        public void jsFunction_replace(String urlString) throws IOException, SAXException {
<span class="fc" id="L715">            _window.setLocation(urlString);</span>
<span class="fc" id="L716">        }</span>

        public String jsGet_href() {
<span class="fc" id="L719">            return toString();</span>
        }

        public void jsSet_href(String urlString) throws SAXException, IOException {
<span class="fc" id="L723">            _window.setLocation(urlString);</span>
<span class="fc" id="L724">        }</span>

        public String jsGet_protocol() {
<span class="fc" id="L727">            return _url.getProtocol() + ':';</span>
        }

        public String jsGet_host() {
<span class="fc" id="L731">            return _url.getHost() + ':' + _url.getPort();</span>
        }

        public String jsGet_hostname() {
<span class="fc" id="L735">            return _url.getHost();</span>
        }

        public String jsGet_port() {
<span class="fc" id="L739">            return String.valueOf(_url.getPort());</span>
        }

        public String jsGet_pathname() {
<span class="fc" id="L743">            return _url.getPath();</span>
        }

        public void jsSet_pathname(String newPath) throws SAXException, IOException {
<span class="pc bpc" id="L747" title="1 of 2 branches missed.">            if (!newPath.startsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L748">                newPath = '/' + newPath;</span>
            }
<span class="fc" id="L750">            URL newURL = new URL(_url, newPath);</span>
<span class="fc" id="L751">            _window.setLocation(newURL.toExternalForm());</span>
<span class="fc" id="L752">        }</span>

        public String jsGet_search() {
<span class="fc" id="L755">            return '?' + _url.getQuery();</span>
        }

        public void jsSet_search(String newSearch) throws SAXException, IOException {
<span class="pc bpc" id="L759" title="1 of 2 branches missed.">            if (!newSearch.startsWith(&quot;?&quot;)) {</span>
<span class="nc" id="L760">                newSearch = '?' + newSearch;</span>
            }
<span class="fc" id="L762">            _window.setLocation(jsGet_protocol() + &quot;//&quot; + jsGet_host() + jsGet_pathname() + newSearch);</span>
<span class="fc" id="L763">        }</span>

        /**
         * Returns the default value of this scriptable object. In this case, it returns simply the URL as a string.
         * Note that this method is necessary, since Rhino will only call the toString method directly if there are no
         * Rhino methods defined (jsGet_*, jsFunction_*, etc.)
         */
        @Override
        public Object getDefaultValue(Class typeHint) {
<span class="fc" id="L772">            return _url.toExternalForm();</span>
        }

        @Override
        public String toString() {
<span class="fc" id="L777">            return _url.toExternalForm();</span>
        }

    }

<span class="fc" id="L782">    static public class Style extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
<span class="fc" id="L785">        private String _display = &quot;inline&quot;;</span>
<span class="fc" id="L786">        private String _visibility = &quot;visible&quot;;</span>

        @Override
        public String getClassName() {
<span class="fc" id="L790">            return &quot;Style&quot;;</span>
        }

        public String jsGet_display() {
<span class="fc" id="L794">            return _display;</span>
        }

        public void jsSet_display(String display) {
<span class="fc" id="L798">            _display = display;</span>
<span class="fc" id="L799">        }</span>

        public String jsGet_visibility() {
<span class="fc" id="L802">            return _visibility;</span>
        }

        public void jsSet_visibility(String visibility) {
<span class="fc" id="L806">            _visibility = visibility;</span>
<span class="fc" id="L807">        }</span>
    }

<span class="fc" id="L810">    static public class Navigator extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private ClientProperties _clientProperties;

        @Override
        public String getClassName() {
<span class="fc" id="L817">            return &quot;Navigator&quot;;</span>
        }

        void setClientProperties(ClientProperties clientProperties) {
<span class="fc" id="L821">            _clientProperties = clientProperties;</span>
<span class="fc" id="L822">        }</span>

        public String jsGet_appName() {
<span class="fc" id="L825">            return _clientProperties.getApplicationName();</span>
        }

        public String jsGet_appCodeName() {
<span class="fc" id="L829">            return _clientProperties.getApplicationCodeName();</span>
        }

        public String jsGet_appVersion() {
<span class="fc" id="L833">            return _clientProperties.getApplicationVersion();</span>
        }

        public String jsGet_userAgent() {
<span class="fc" id="L837">            return _clientProperties.getUserAgent();</span>
        }

        public String jsGet_platform() {
<span class="fc" id="L841">            return _clientProperties.getPlatform();</span>
        }

        public Object[] jsGet_plugins() {
<span class="fc" id="L845">            return new Object[0];</span>
        }

        public boolean jsFunction_javaEnabled() {
<span class="fc" id="L849">            return false; // no support is provided for applets at present</span>
        }

    }

<span class="fc" id="L854">    static public class Screen extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private ClientProperties _clientProperties;

        void setClientProperties(ClientProperties clientProperties) {
<span class="fc" id="L860">            _clientProperties = clientProperties;</span>
<span class="fc" id="L861">        }</span>

        @Override
        public String getClassName() {
<span class="fc" id="L865">            return &quot;Screen&quot;;</span>
        }

        public int jsGet_availWidth() {
<span class="fc" id="L869">            return _clientProperties.getAvailableScreenWidth();</span>
        }

        public int jsGet_availHeight() {
<span class="fc" id="L873">            return _clientProperties.getAvailHeight();</span>
        }

    }

    static public class ElementArray extends ScriptableObject {

        private static final long serialVersionUID = 1L;
<span class="fc" id="L881">        private JavaScriptEngine[] _contents = new HTMLElement[0];</span>

        static ElementArray newElementArray(Scriptable parent) {
            try {
<span class="fc" id="L885">                return (ElementArray) Context.getCurrentContext().newObject(parent, &quot;ElementArray&quot;);</span>
<span class="nc" id="L886">            } catch (EvaluatorException | JavaScriptException e) {</span>
<span class="nc" id="L887">                throw new RhinoException(e);</span>
            }
        }

<span class="fc" id="L891">        public ElementArray() {</span>
<span class="fc" id="L892">        }</span>

        void initialize(JavaScriptEngine[] contents) {
<span class="fc" id="L895">            _contents = contents;</span>
<span class="fc" id="L896">        }</span>

        public int jsGet_length() {
<span class="fc" id="L899">            return _contents.length;</span>
        }

        @Override
        public String getClassName() {
<span class="fc" id="L904">            return &quot;ElementArray&quot;;</span>
        }

        @Override
        public Object get(int i, Scriptable scriptable) {
<span class="pc bpc" id="L909" title="2 of 4 branches missed.">            if (i &gt;= 0 &amp;&amp; i &lt; _contents.length) {</span>
<span class="fc" id="L910">                return _contents[i];</span>
            }
<span class="nc" id="L912">            return super.get(i, scriptable);</span>
        }

        @Override
        public Object get(String name, Scriptable scriptable) {
<span class="fc bfc" id="L917" title="All 2 branches covered.">            for (JavaScriptEngine content : _contents) {</span>
<span class="fc bfc" id="L918" title="All 2 branches covered.">                if (name.equalsIgnoreCase(content.getID())) {</span>
<span class="fc" id="L919">                    return content;</span>
                }
            }
<span class="fc bfc" id="L922" title="All 2 branches covered.">            for (JavaScriptEngine content : _contents) {</span>
<span class="fc bfc" id="L923" title="All 2 branches covered.">                if (name.equalsIgnoreCase(content.getName())) {</span>
<span class="fc" id="L924">                    return content;</span>
                }
            }
<span class="fc" id="L927">            return super.get(name, scriptable);</span>
        }

        protected JavaScriptEngine[] getContents() {
<span class="nc" id="L931">            return _contents;</span>
        }
    }

    /**
     * HTML Element support for JavaScript
     */
<span class="fc" id="L938">    static public class HTMLElement extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private Style _style;
        private Document _document;

        @Override
        public String getClassName() {
<span class="fc" id="L946">            return &quot;HTMLElement&quot;;</span>
        }

        public Document jsGet_document() {
<span class="fc" id="L950">            return _document;</span>
        }

        public Style jsGet_style() {
<span class="fc" id="L954">            return _style;</span>
        }

        /**
         * arbitrary attribute access
         *
         * @param attributeName
         *
         * @return
         */
        public Object jsFunction_getAttribute(String attributeName) {
<span class="nc" id="L965">            return _scriptable.get(attributeName);</span>
        }

        @Override
        void initialize(JavaScriptEngine parent, ScriptableDelegate scriptable)
                throws JavaScriptException, EvaluatorException, SAXException {
<span class="fc" id="L971">            super.initialize(parent, scriptable);</span>
<span class="fc" id="L972">            _document = (Document) parent;</span>
<span class="fc" id="L973">            _style = (Style) Context.getCurrentContext().newObject(this, &quot;Style&quot;);</span>
<span class="fc" id="L974">        }</span>

    }

<span class="fc" id="L978">    static public class Image extends HTMLElement {</span>

        private static final long serialVersionUID = 1L;

        @Override
        public String getClassName() {
<span class="fc" id="L984">            return &quot;Image&quot;;</span>
        }
    }

<span class="fc" id="L988">    static public class Link extends HTMLElement {</span>

        private static final long serialVersionUID = 1L;

        @Override
        public Document jsGet_document() {
<span class="fc" id="L994">            return super.jsGet_document();</span>
        }

        @Override
        public String getClassName() {
<span class="fc" id="L999">            return &quot;Link&quot;;</span>
        }
    }

    /**
     * Form functions
     */
<span class="fc" id="L1006">    static public class Form extends HTMLElement {</span>

        private static final long serialVersionUID = 1L;
        private ElementArray _controls;

        @Override
        public String getClassName() {
<span class="fc" id="L1013">            return &quot;Form&quot;;</span>
        }

        public String jsGet_name() {
<span class="fc" id="L1017">            return getDelegate().getName();</span>
        }

        /**
         * @since FR [ 2163079 ] make form.name property mutable by Peter De Bruycker
         *
         * @param name
         */
        public void jsSet_name(String name) {
<span class="fc" id="L1026">            getDelegate().set(&quot;name&quot;, name);</span>
<span class="fc" id="L1027">        }</span>

        public String jsGet_action() {
<span class="nc" id="L1030">            return getDelegate().getAction();</span>
        }

        public void jsSet_action(String action) {
<span class="nc" id="L1034">            getDelegate().setAction(action);</span>
<span class="nc" id="L1035">        }</span>

        public Scriptable jsGet_elements() throws EvaluatorException, JavaScriptException {
<span class="fc bfc" id="L1038" title="All 2 branches covered.">            if (_controls == null) {</span>
<span class="fc" id="L1039">                initializeControls();</span>
            }
<span class="fc" id="L1041">            return _controls;</span>
        }

        public Object jsFunction_getElementsByTagName(String name) throws SAXException {
<span class="fc" id="L1045">            return toElementArray(getDelegate().getElementsByTagName(name));</span>
        }

        public void jsFunction_submit() throws IOException, SAXException {
<span class="fc" id="L1049">            getDelegate().submit();</span>
<span class="fc" id="L1050">        }</span>

        public void jsFunction_reset() throws IOException, SAXException {
<span class="fc" id="L1053">            getDelegate().reset();</span>
<span class="fc" id="L1054">        }</span>

        private void initializeControls() throws EvaluatorException, JavaScriptException {
<span class="fc" id="L1057">            ScriptableDelegate[] scriptables = getDelegate().getElementDelegates();</span>
<span class="fc" id="L1058">            Control[] controls = new Control[scriptables.length];</span>
<span class="fc bfc" id="L1059" title="All 2 branches covered.">            for (int i = 0; i &lt; controls.length; i++) {</span>
<span class="fc" id="L1060">                controls[i] = (Control) toScriptable(scriptables[i]);</span>
            }
<span class="fc" id="L1062">            _controls = (ElementArray) Context.getCurrentContext().newObject(this, &quot;ElementArray&quot;);</span>
<span class="fc" id="L1063">            _controls.initialize(controls);</span>
<span class="fc" id="L1064">        }</span>

        private WebForm.Scriptable getDelegate() {
<span class="fc" id="L1067">            return (WebForm.Scriptable) _scriptable;</span>
        }

    }

    /**
     * Javascript support for any control
     */
<span class="fc" id="L1075">    static public class Control extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;
        private Form _form;

        @Override
        public String getClassName() {
<span class="fc" id="L1082">            return &quot;Control&quot;;</span>
        }

        public Form jsGet_form() {
<span class="fc" id="L1086">            return _form;</span>
        }

        public void jsFunction_focus() {
<span class="nc" id="L1090">        }</span>

        public void jsFunction_select() {
<span class="nc" id="L1093">        }</span>

        /**
         * click via javascript
         *
         * @throws IOException
         * @throws SAXException
         */
        public void jsFunction_click() throws IOException, SAXException {
<span class="fc" id="L1102">            getDelegate().click();</span>
<span class="fc" id="L1103">        }</span>

        private Input getDelegate() {
<span class="fc" id="L1106">            return (Input) _scriptable;</span>
        }

        /** Support getting value of arbitrary attribute */
        public Object jsFunction_getAttribute(String attributeName) throws JavaScriptException {
<span class="fc" id="L1111">            return getDelegate().get(attributeName);</span>
        }

        /** Support getting value of arbitrary attribute */
        public void jsFunction_setAttribute(String attributeName, Object value) throws JavaScriptException {
<span class="fc" id="L1116">            getDelegate().setAttribute(attributeName, value);</span>
<span class="fc" id="L1117">        }</span>

        /** Support getting value of arbitrary attribute */
        public void jsFunction_removeAttribute(String attributeName) throws JavaScriptException {
<span class="nc" id="L1121">            getDelegate().removeAttribute(attributeName);</span>
<span class="nc" id="L1122">        }</span>

        /** Allow calling onchange() from within a JavaScript function */
        public void jsFunction_onchange() throws JavaScriptException {
<span class="fc" id="L1126">            Input myInput = this.getDelegate();</span>
<span class="fc" id="L1127">            myInput.sendOnChangeEvent();</span>
<span class="fc" id="L1128">        }</span>

        @Override
        void initialize(JavaScriptEngine parent, ScriptableDelegate scriptable)
                throws JavaScriptException, EvaluatorException, SAXException {
<span class="fc" id="L1133">            super.initialize(parent, scriptable);</span>
<span class="fc bfc" id="L1134" title="All 2 branches covered.">            if (parent instanceof Form) {</span>
<span class="fc" id="L1135">                _form = (Form) parent;</span>
            }
<span class="fc" id="L1137">        }</span>

    }

<span class="fc" id="L1141">    static public class Options extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;

        @Override
        public String getClassName() {
<span class="fc" id="L1147">            return &quot;Options&quot;;</span>
        }

        public int jsGet_length() {
<span class="fc" id="L1151">            return getDelegate().getLength();</span>
        }

        public void jsSet_length(int length) {
<span class="fc" id="L1155">            getDelegate().setLength(length);</span>
<span class="fc" id="L1156">        }</span>

        @Override
        public void put(int i, Scriptable scriptable, Object object) {
<span class="fc bfc" id="L1160" title="All 2 branches covered.">            if (object == null) {</span>
<span class="fc" id="L1161">                getDelegate().put(i, null);</span>
            } else {
<span class="pc bpc" id="L1163" title="1 of 2 branches missed.">                if (!(object instanceof Option)) {</span>
<span class="nc" id="L1164">                    throw new IllegalArgumentException(&quot;May only add an Option to this array&quot;);</span>
                }
<span class="fc" id="L1166">                Option option = (Option) object;</span>
<span class="fc" id="L1167">                getDelegate().put(i, option.getDelegate());</span>
            }
<span class="fc" id="L1169">        }</span>

        private SelectionOptions getDelegate() {
<span class="fc" id="L1172">            return (SelectionOptions) _scriptable;</span>
        }

    }

<span class="fc" id="L1177">    static public class Option extends JavaScriptEngine {</span>

        private static final long serialVersionUID = 1L;

        @Override
        public String getClassName() {
<span class="fc" id="L1183">            return &quot;Option&quot;;</span>
        }

        public void jsConstructor(String text, String value, boolean defaultSelected, boolean selected) {
<span class="fc" id="L1187">            _scriptable = WebResponse.newDelegate(&quot;Option&quot;);</span>
<span class="fc" id="L1188">            getDelegate().initialize(text, value, defaultSelected, selected);</span>
<span class="fc" id="L1189">        }</span>

        public int jsGet_index() {
<span class="fc" id="L1192">            return getDelegate().getIndex();</span>
        }

        public String jsGet_text() {
<span class="fc" id="L1196">            return getDelegate().getText();</span>
        }

        public void jsSet_text(String text) {
<span class="fc" id="L1200">            getDelegate().setText(text);</span>
<span class="fc" id="L1201">        }</span>

        public String jsGet_value() {
<span class="fc" id="L1204">            return getDelegate().getValue();</span>
        }

        public void jsSet_value(String value) {
<span class="fc" id="L1208">            getDelegate().setValue(value);</span>
<span class="fc" id="L1209">        }</span>

        public boolean jsGet_selected() {
<span class="fc" id="L1212">            return getDelegate().isSelected();</span>
        }

        public void jsSet_selected(boolean selected) {
<span class="fc" id="L1216">            getDelegate().setSelected(selected);</span>
<span class="fc" id="L1217">        }</span>

        public boolean jsGet_defaultSelected() {
<span class="nc" id="L1220">            return getDelegate().isDefaultSelected();</span>
        }

        SelectionOption getDelegate() {
<span class="fc" id="L1224">            return (SelectionOption) _scriptable;</span>
        }
    }

}

/**
 * special exception for the Rhino Javscript engine
 */
class RhinoException extends RuntimeException {

    private static final long serialVersionUID = 1L;
    private Exception _cause;

<span class="nc" id="L1238">    public RhinoException(Exception cause) {</span>
<span class="nc" id="L1239">        _cause = cause;</span>
<span class="nc" id="L1240">    }</span>

    @Override
    public String getMessage() {
<span class="nc" id="L1244">        return &quot;Rhino exception: &quot; + _cause;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>