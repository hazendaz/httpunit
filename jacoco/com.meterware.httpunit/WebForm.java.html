<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebForm.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">httpunit</a> &gt; <a href="index.source.html" class="el_package">com.meterware.httpunit</a> &gt; <span class="el_source">WebForm.java</span></div><h1>WebForm.java</h1><pre class="source lang-java linenums">/*
 * MIT License
 *
 * Copyright 2011-2025 Russell Gold
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and
 * to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
 * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
 * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 */
package com.meterware.httpunit;

import com.meterware.httpunit.protocol.ParameterProcessor;
import com.meterware.httpunit.protocol.UploadFileSpec;
import com.meterware.httpunit.scripting.FormScriptable;
import com.meterware.httpunit.scripting.IdentifiedDelegate;
import com.meterware.httpunit.scripting.NamedDelegate;
import com.meterware.httpunit.scripting.ScriptableDelegate;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.net.UnknownServiceException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.w3c.dom.Node;
import org.w3c.dom.html.HTMLCollection;
import org.w3c.dom.html.HTMLFormElement;
import org.xml.sax.SAXException;

/**
 * This class represents a form in an HTML page. Users of this class may examine the parameters defined for the form,
 * the structure of the form (as a DOM), or the text of the form. They may also create a {@link WebRequest} to simulate
 * the submission of the form.
 **/
public class WebForm extends WebRequestSource {

    /** The Constant NO_VALUES. */
<span class="fc" id="L51">    private static final String[] NO_VALUES = {};</span>

    /** The buttons. */
    private Button[] _buttons;

    /** The submit buttons in this form. **/
    private SubmitButton[] _submitButtons;

    /** The character set in which the form will be submitted. **/
    private String _characterSet;

    /** The button list. */
    private List&lt;SubmitButton&gt; _buttonVector;

    /** The preset parameters. */
    private FormControl[] _presetParameters;

    /** The presets. */
    private ArrayList _presets;

    /** The registry. */
    private ElementRegistry _registry;

    /** Predicate to match a link's name. **/
    public static final HTMLElementPredicate MATCH_NAME;

    /** The dom element. */
    private HTMLFormElement _domElement;

    /**
     * Submits this form using the web client from which it was originally obtained.
     *
     * @return the web response
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     * @throws SAXException
     *             the SAX exception
     */
    public WebResponse submit() throws IOException, SAXException {
<span class="fc" id="L91">        return submit(getDefaultButton());</span>
    }

    /**
     * Submits this form using the web client from which it was originally obtained. Will usually return the result of
     * that submission; however, if the submit button's 'onclick' or the form's 'onsubmit' event is triggered and
     * inhibits the submission, will return the updated contents of the frame containing this form.
     *
     * @param button
     *            the button
     *
     * @return the web response
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     * @throws SAXException
     *             the SAX exception
     */
    public WebResponse submit(SubmitButton button) throws IOException, SAXException {
<span class="fc" id="L110">        return submit(button, 0, 0);</span>
    }

    /**
     * Submits this form using the web client from which it was originally obtained. Will usually return the result of
     * that submission; however, if the submit button's 'onclick' or the form's 'onsubmit' event is triggered and
     * inhibits the submission, will return the updated contents of the frame containing this form.
     *
     * @param button
     *            the button
     * @param x
     *            the x
     * @param y
     *            the y
     *
     * @return the web response
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     * @throws SAXException
     *             the SAX exception
     */
    public WebResponse submit(SubmitButton button, int x, int y) throws IOException, SAXException {
<span class="fc bfc" id="L133" title="All 2 branches covered.">        if (button == null) {</span>
<span class="fc" id="L134">            throw new IllegalSubmitButtonException(&quot;?&quot;, &quot;?&quot;);</span>
        }
<span class="fc" id="L136">        button.doOnClickSequence(x, y);</span>
<span class="fc" id="L137">        return getCurrentFrameContents();</span>
    }

    /**
     * Submits this form using the web client from which it was originally obtained, ignoring any buttons defined for
     * the form.
     *
     * @return the web response
     *
     * @throws SAXException
     *             the SAX exception
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    public WebResponse submitNoButton() throws SAXException, IOException {
<span class="fc" id="L152">        return submit(SubmitButton.createFakeSubmitButton(this /* fake */));</span>
    }

    @Override
    protected WebResponse submitRequest(String event, WebRequest request) throws IOException, SAXException {
        try {
<span class="fc" id="L158">            return super.submitRequest(event, request);</span>
<span class="fc" id="L159">        } catch (UnknownServiceException e) {</span>
<span class="fc" id="L160">            throw new UnsupportedActionException(</span>
<span class="fc" id="L161">                    &quot;HttpUnit does not support &quot; + request.getURL().getProtocol() + &quot; URLs in form submissions&quot;);</span>
        }
    }

    /**
     * Submits the form without also invoking the button's &quot;onclick&quot; event.
     *
     * @param button
     *            the button
     *
     * @return the web response
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     * @throws SAXException
     *             the SAX exception
     */
    WebResponse doFormSubmit(SubmitButton button) throws IOException, SAXException {
<span class="nc" id="L179">        return submitRequest(getAttribute(&quot;onsubmit&quot;), getRequest(button));</span>
    }

    /**
     * Do form submit.
     *
     * @param button
     *            the button
     * @param x
     *            the x
     * @param y
     *            the y
     *
     * @return the web response
     *
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     * @throws SAXException
     *             the SAX exception
     */
    WebResponse doFormSubmit(SubmitButton button, int x, int y) throws IOException, SAXException {
<span class="fc" id="L200">        return submitRequest(getAttribute(&quot;onsubmit&quot;), getRequest(button, x, y));</span>
    }

    /**
     * Returns the method defined for this form.
     *
     * @return the method
     */
    public String getMethod() {
<span class="fc" id="L209">        return getAttribute(&quot;method&quot;, &quot;GET&quot;);</span>
    }

    /**
     * Returns the action defined for this form.
     *
     * @return the action
     */
    public String getAction() {
<span class="fc" id="L218">        return getDestination();</span>
    }

    /**
     * Returns true if a parameter with given name exists in this form.
     *
     * @param soughtName
     *            the sought name
     *
     * @return true, if successful
     */
    public boolean hasParameterNamed(String soughtName) {
<span class="fc" id="L230">        return getFormParameters().containsKey(soughtName);</span>
    }

    /**
     * Returns true if a parameter starting with a given name exists,.
     *
     * @param prefix
     *            the prefix
     *
     * @return true, if successful
     */
    public boolean hasParameterStartingWithPrefix(String prefix) {
<span class="fc" id="L242">        String[] names = getParameterNames();</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">        for (String name : names) {</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">            if (name.startsWith(prefix)) {</span>
<span class="fc" id="L245">                return true;</span>
            }
        }
<span class="nc" id="L248">        return false;</span>
    }

    /**
     * Returns an array containing all of the buttons defined for this form.
     *
     * @return the buttons
     */
    public Button[] getButtons() {
<span class="fc bfc" id="L257" title="All 2 branches covered.">        if (_buttons == null) {</span>
<span class="fc" id="L258">            FormControl[] controls = getFormControls();</span>
<span class="fc" id="L259">            List&lt;FormControl&gt; buttonList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">            for (FormControl control : controls) {</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">                if (control instanceof Button) {</span>
<span class="fc" id="L262">                    buttonList.add(control);</span>
                }
            }
<span class="fc" id="L265">            _buttons = (Button[]) buttonList.toArray(new Button[buttonList.size()]);</span>
        }
<span class="fc" id="L267">        return _buttons;</span>
    }

    /**
     * Gets the button.
     *
     * @param predicate
     *            the predicate
     * @param criteria
     *            the criteria
     *
     * @return the button
     */
    public Button getButton(HTMLElementPredicate predicate, Object criteria) {
<span class="fc" id="L281">        Button[] buttons = getButtons();</span>
<span class="pc bpc" id="L282" title="1 of 2 branches missed.">        for (Button button : buttons) {</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">            if (predicate.matchesCriteria(button, criteria)) {</span>
<span class="fc" id="L284">                return button;</span>
            }
        }
<span class="nc" id="L287">        return null;</span>
    }

    /**
     * Convenience method which returns the button with the specified ID.
     *
     * @param buttonID
     *            the button ID
     *
     * @return the button with ID
     */
    public Button getButtonWithID(String buttonID) {
<span class="fc" id="L299">        return getButton(Button.WITH_ID, buttonID);</span>
    }

    /**
     * Returns an array containing the submit buttons defined for this form.
     *
     * @return the submit buttons
     */
    public SubmitButton[] getSubmitButtons() {
<span class="fc bfc" id="L308" title="All 2 branches covered.">        if (_submitButtons == null) {</span>
<span class="fc" id="L309">            List&lt;SubmitButton&gt; buttons = getSubmitButtonVector();</span>
<span class="fc" id="L310">            _submitButtons = buttons.toArray(new SubmitButton[buttons.size()]);</span>
        }
<span class="fc" id="L312">        return _submitButtons;</span>
    }

    /**
     * Returns the submit button defined in this form with the specified name. If more than one such button exists, will
     * return the first found. If no such button is found, will return null.
     *
     * @param name
     *            the name
     *
     * @return the submit button
     */
    public SubmitButton getSubmitButton(String name) {
<span class="fc" id="L325">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="fc bfc" id="L326" title="All 2 branches covered.">        for (SubmitButton button : buttons) {</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">            if (button.getName().equals(name)) {</span>
<span class="fc" id="L328">                return button;</span>
            }
        }
<span class="fc" id="L331">        return null;</span>
    }

    /**
     * Returns the submit button defined in this form with the specified name and value. If more than one such button
     * exists, will return the first found. If no such button is found, will return null.
     *
     * @param name
     *            the name
     * @param value
     *            the value
     *
     * @return the submit button
     */
    public SubmitButton getSubmitButton(String name, String value) {
<span class="fc" id="L346">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">        for (SubmitButton button : buttons) {</span>
<span class="pc bpc" id="L348" title="1 of 4 branches missed.">            if (button.getName().equals(name) &amp;&amp; button.getValue().equals(value)) {</span>
<span class="fc" id="L349">                return button;</span>
            }
        }
<span class="nc" id="L352">        return null;</span>
    }

    /**
     * Returns the submit button defined in this form with the specified ID. If more than one such button exists, will
     * return the first found. If no such button is found, will return null.
     *
     * @param ID
     *            the id
     *
     * @return the submit button with ID
     */
    public SubmitButton getSubmitButtonWithID(String ID) {
<span class="fc" id="L365">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="pc bpc" id="L366" title="1 of 2 branches missed.">        for (SubmitButton button : buttons) {</span>
<span class="pc bpc" id="L367" title="1 of 2 branches missed.">            if (button.getID().equals(ID)) {</span>
<span class="fc" id="L368">                return button;</span>
            }
        }
<span class="nc" id="L371">        return null;</span>
    }

    /**
     * Creates and returns a web request which will simulate the submission of this form with a button with the
     * specified name and value.
     *
     * @param submitButtonName
     *            the submit button name
     * @param submitButtonValue
     *            the submit button value
     *
     * @return the request
     */
    public WebRequest getRequest(String submitButtonName, String submitButtonValue) {
<span class="fc" id="L386">        SubmitButton sb = getSubmitButton(submitButtonName, submitButtonValue);</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">        if (sb == null) {</span>
<span class="nc" id="L388">            throw new IllegalSubmitButtonException(submitButtonName, submitButtonValue);</span>
        }
<span class="fc" id="L390">        return getRequest(sb);</span>
    }

    /**
     * Creates and returns a web request which will simulate the submission of this form with a button with the
     * specified name.
     *
     * @param submitButtonName
     *            the submit button name
     *
     * @return the request
     */
    public WebRequest getRequest(String submitButtonName) {
<span class="fc" id="L403">        SubmitButton sb = getSubmitButton(submitButtonName);</span>
<span class="pc bpc" id="L404" title="1 of 2 branches missed.">        if (sb == null) {</span>
<span class="nc" id="L405">            throw new IllegalSubmitButtonException(submitButtonName, &quot;&quot;);</span>
        }
<span class="fc" id="L407">        return getRequest(sb);</span>
    }

    /**
     * Creates and returns a web request which will simulate the submission of this form by pressing the specified
     * button. If the button is null, simulates the pressing of the default button.
     *
     * @param button
     *            the button
     *
     * @return the request
     */
    public WebRequest getRequest(SubmitButton button) {
<span class="fc" id="L420">        return getRequest(button, 0, 0);</span>
    }

    /**
     * Creates and returns a web request which will simulate the submission of this form by pressing the specified
     * button. If the button is null, simulates the pressing of the default button.
     *
     * @param button
     *            - the submitbutton to be pressed - may be null
     * @param x
     *            - the x position
     * @param y
     *            - the y position
     *
     * @return the request
     */
    public WebRequest getRequest(SubmitButton button, int x, int y) {
<span class="fc bfc" id="L437" title="All 2 branches covered.">        if (button == null) {</span>
<span class="fc" id="L438">            button = getDefaultButton();</span>
        }

<span class="fc bfc" id="L441" title="All 2 branches covered.">        if (HttpUnitOptions.getParameterValuesValidated()) {</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">            if (button == null) {</span>
<span class="fc" id="L443">                throw new IllegalUnnamedSubmitButtonException();</span>
            }
<span class="fc bfc" id="L445" title="All 2 branches covered.">            if (button.isFake()) {</span>
                // bypass checks
<span class="fc bfc" id="L447" title="All 2 branches covered.">            } else if (!getSubmitButtonVector().contains(button)) {</span>
<span class="fc" id="L448">                throw new IllegalSubmitButtonException(button);</span>
<span class="fc bfc" id="L449" title="All 2 branches covered.">            } else if (!button.wasEnabled()) {</span>
                // this is too late for the check of isDisabled()
                // onclick has already been done ...
                // [ 1289151 ] Order of events in button.click() is wrong
<span class="nc" id="L453">                button.throwDisabledException();</span>
            }
        }

<span class="fc" id="L457">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="fc bfc" id="L458" title="All 2 branches covered.">        for (SubmitButton button2 : buttons) {</span>
<span class="fc" id="L459">            button2.setPressed(false);</span>
        }
<span class="fc" id="L461">        button.setPressed(true);</span>

<span class="fc bfc" id="L463" title="All 2 branches covered.">        if (getMethod().equalsIgnoreCase(&quot;post&quot;)) {</span>
<span class="fc" id="L464">            return new PostMethodWebRequest(this, button, x, y);</span>
        }
<span class="fc" id="L466">        return new GetMethodWebRequest(this, WebRequest.newParameterHolder(this), button, x, y);</span>
    }

    /**
     * Creates and returns a web request which includes the specified button. If no button is specified, will include
     * the default button, if any. No parameter validation will be done on the returned request and no scripts will be
     * run when it is submitted.
     *
     * @param button
     *            the button
     *
     * @return the web request
     */
    public WebRequest newUnvalidatedRequest(SubmitButton button) {
<span class="fc" id="L480">        return newUnvalidatedRequest(button, 0, 0);</span>
    }

    /**
     * Creates and returns a web request which includes the specified button and position. If no button is specified,
     * will include the default button, if any. No parameter validation will be done on the returned request and no
     * scripts will be run when it is submitted.
     *
     * @param button
     *            the button
     * @param x
     *            the x
     * @param y
     *            the y
     *
     * @return the web request
     */
    public WebRequest newUnvalidatedRequest(SubmitButton button, int x, int y) {
<span class="fc bfc" id="L498" title="All 2 branches covered.">        if (button == null) {</span>
<span class="fc" id="L499">            button = getDefaultButton();</span>
        }

<span class="fc" id="L502">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="fc bfc" id="L503" title="All 2 branches covered.">        for (SubmitButton button2 : buttons) {</span>
<span class="fc" id="L504">            button2.setPressed(false);</span>
        }
<span class="fc" id="L506">        button.setPressed(true);</span>

<span class="fc bfc" id="L508" title="All 2 branches covered.">        if (getMethod().equalsIgnoreCase(&quot;post&quot;)) {</span>
<span class="fc" id="L509">            return new PostMethodWebRequest(this, new UncheckedParameterHolder(this), button, x, y);</span>
        }
<span class="fc" id="L511">        return new GetMethodWebRequest(this, new UncheckedParameterHolder(this), button, x, y);</span>
    }

    /**
     * Gets the scripted submit request.
     *
     * @return the scripted submit request
     */
    private WebRequest getScriptedSubmitRequest() {
<span class="fc" id="L520">        SubmitButton[] buttons = getSubmitButtons();</span>
<span class="fc bfc" id="L521" title="All 2 branches covered.">        for (SubmitButton button : buttons) {</span>
<span class="fc" id="L522">            button.setPressed(false);</span>
        }

<span class="fc bfc" id="L525" title="All 2 branches covered.">        if (getMethod().equalsIgnoreCase(&quot;post&quot;)) {</span>
<span class="fc" id="L526">            return new PostMethodWebRequest(this);</span>
        }
<span class="fc" id="L528">        return new GetMethodWebRequest(this);</span>

    }

    /**
     * Returns the default value of the named parameter. If the parameter does not exist returns null.
     *
     * @param name
     *            the name
     *
     * @return the parameter value
     */
    public String getParameterValue(String name) {
<span class="fc" id="L541">        String[] values = getParameterValues(name);</span>
<span class="fc bfc" id="L542" title="All 2 branches covered.">        return values.length == 0 ? null : values[0];</span>
    }

    /**
     * Returns the displayed options defined for the specified parameter name.
     *
     * @param name
     *            the name
     *
     * @return the options
     */
    public String[] getOptions(String name) {
<span class="fc" id="L554">        return getParameter(name).getOptions();</span>
    }

    /**
     * Returns the option values defined for the specified parameter name.
     *
     * @param name
     *            the name
     *
     * @return the option values
     */
    public String[] getOptionValues(String name) {
<span class="fc" id="L566">        return getParameter(name).getOptionValues();</span>
    }

    /**
     * Returns true if the named parameter accepts multiple values.
     *
     * @param name
     *            the name
     *
     * @return true, if is multi valued parameter
     */
    public boolean isMultiValuedParameter(String name) {
<span class="nc" id="L578">        return getParameter(name).isMultiValuedParameter();</span>
    }

    /**
     * Returns the number of text parameters in this form with the specified name.
     *
     * @param name
     *            the name
     *
     * @return the num text parameters
     */
    public int getNumTextParameters(String name) {
<span class="fc" id="L590">        return getParameter(name).getNumTextParameters();</span>
    }

    /**
     * Returns true if the named parameter accepts free-form text.
     *
     * @param name
     *            the name
     *
     * @return true, if is text parameter
     */
    public boolean isTextParameter(String name) {
<span class="nc" id="L602">        return getParameter(name).isTextParameter();</span>
    }

    /**
     * Returns true if this form is to be submitted using mime encoding (the default is URL encoding).
     **/
    @Override
    public boolean isSubmitAsMime() {
<span class="fc" id="L610">        return &quot;multipart/form-data&quot;.equalsIgnoreCase(getAttribute(&quot;enctype&quot;));</span>
    }

    /**
     * Gets the scriptable object.
     *
     * @return the scriptable object
     */
    public FormScriptable getScriptableObject() {
<span class="fc" id="L619">        return (FormScriptable) getScriptingHandler();</span>
    }

    /**
     * Resets all parameters to their initial values.
     */
    public void reset() {
<span class="pc bpc" id="L626" title="1 of 2 branches missed.">        if (handleEvent(&quot;onreset&quot;)) {</span>
<span class="fc" id="L627">            resetControls();</span>
        }
<span class="fc" id="L629">    }</span>

    /**
     * Reset controls.
     */
    private void resetControls() {
<span class="fc" id="L635">        FormControl[] controls = getFormControls();</span>
<span class="fc bfc" id="L636" title="All 2 branches covered.">        for (FormControl control : controls) {</span>
<span class="fc" id="L637">            control.reset();</span>
        }
<span class="fc" id="L639">    }</span>

    @Override
    public ScriptableDelegate newScriptable() {
<span class="fc" id="L643">        return new Scriptable();</span>
    }

    // ---------------------------------- WebRequestSource methods
    // --------------------------------

    /**
     * Returns the character set encoding for this form.
     **/
    @Override
    public String getCharacterSet() {
<span class="fc" id="L654">        return _characterSet;</span>
    }

    /**
     * Returns true if the named parameter accepts files for upload.
     **/
    @Override
    public boolean isFileParameter(String name) {
<span class="fc" id="L662">        return getParameter(name).isFileParameter();</span>
    }

    /**
     * Returns an array containing the names of the parameters defined for this form.
     **/
    @Override
    public String[] getParameterNames() {
<span class="fc" id="L670">        List parameterNames = new ArrayList(getFormParameters().keySet());</span>
<span class="fc" id="L671">        return (String[]) parameterNames.toArray(new String[parameterNames.size()]);</span>
    }

    /**
     * Returns the multiple default values of the named parameter.
     **/
    @Override
    public String[] getParameterValues(String name) {
<span class="fc" id="L679">        final FormParameter parameter = getParameter(name);</span>
<span class="fc" id="L680">        return parameter.getValues();</span>
    }

    /**
     * Returns true if the named parameter is read-only. If more than one control exists with the same name, will return
     * true only if all such controls are read-only.
     *
     * @param name
     *            the name
     *
     * @return true, if is read only parameter
     */
    public boolean isReadOnlyParameter(String name) {
<span class="fc" id="L693">        return getParameter(name).isReadOnlyParameter();</span>
    }

    /**
     * Returns true if the named parameter is disabled. If more than one control exists with the same name, will return
     * true only if all such controls are read-only.
     *
     * @param name
     *            the name
     *
     * @return true, if is disabled parameter
     */
    public boolean isDisabledParameter(String name) {
<span class="fc" id="L706">        return getParameter(name).isDisabledParameter();</span>
    }

    /**
     * Returns true if the named parameter is hidden. If more than one control exists with the same name, will return
     * true only if all such controls are hidden.
     *
     * @param name
     *            the name
     *
     * @return true, if is hidden parameter
     */
    public boolean isHiddenParameter(String name) {
<span class="fc" id="L719">        return getParameter(name).isHiddenParameter();</span>
    }

    /**
     * Creates and returns a web request which will simulate the submission of this form with an unnamed submit button.
     **/
    @Override
    public WebRequest getRequest() {
<span class="fc" id="L727">        return getRequest((SubmitButton) null);</span>
    }

    /**
     * Creates and returns a web request based on the current state of this form. No parameter validation will be done
     * and there is no guarantee over the order of parameters transmitted.
     *
     * @return the web request
     */
    public WebRequest newUnvalidatedRequest() {
<span class="fc" id="L737">        return newUnvalidatedRequest(null);</span>
    }

    /**
     * Records a parameter defined by including it in the destination URL. Ignores any parameters whose name matches a
     * form control.
     **/
    @Override
    protected void addPresetParameter(String name, String value) {
<span class="fc" id="L746">        FormControl[] formControls = getFormControls();</span>
<span class="fc bfc" id="L747" title="All 2 branches covered.">        for (FormControl formControl : formControls) {</span>
<span class="fc bfc" id="L748" title="All 2 branches covered.">            if (formControl.getName().equals(name)) {</span>
<span class="fc" id="L749">                return;</span>
            }
        }
<span class="fc" id="L752">        _presets.add(new PresetFormParameter(this, name, value));</span>
<span class="fc" id="L753">    }</span>

    @Override
    protected String getEmptyParameterValue() {
<span class="fc" id="L757">        return null;</span>
    }

    // ---------------------------------- ParameterHolder methods
    // --------------------------------

    /**
     * Specifies the position at which an image button (if any) was clicked.
     **/
    @Override
    void selectImageButtonPosition(SubmitButton imageButton, int x, int y) {
<span class="fc" id="L768">        imageButton.setLocation(x, y);</span>
<span class="fc" id="L769">    }</span>

    /**
     * Iterates through the fixed, predefined parameters in this holder, recording them in the supplied parameter
     * processor.\ These parameters always go on the URL, no matter what encoding method is used.
     **/

    @Override
    void recordPredefinedParameters(ParameterProcessor processor) throws IOException {
<span class="fc" id="L778">        FormControl[] controls = getPresetParameters();</span>
<span class="fc bfc" id="L779" title="All 2 branches covered.">        for (FormControl control : controls) {</span>
<span class="fc" id="L780">            control.addValues(processor, getCharacterSet());</span>
        }
<span class="fc" id="L782">    }</span>

    /**
     * Iterates through the parameters in this holder, recording them in the supplied parameter processor.
     **/
    @Override
    public void recordParameters(ParameterProcessor processor) throws IOException {
<span class="fc" id="L789">        FormControl[] controls = getFormControls();</span>
<span class="fc bfc" id="L790" title="All 2 branches covered.">        for (FormControl control : controls) {</span>
<span class="fc" id="L791">            control.addValues(processor, getCharacterSet());</span>
        }
<span class="fc" id="L793">    }</span>

    /**
     * Removes a parameter name from this collection.
     **/
    @Override
    public void removeParameter(String name) {
<span class="fc" id="L800">        setParameter(name, NO_VALUES);</span>
<span class="fc" id="L801">    }</span>

    /**
     * Sets the value of a parameter in this form.
     *
     * @param name
     *            - the name of the parameter
     * @param value
     *            - the value of the parameter
     **/
    @Override
    public void setParameter(String name, String value) {
<span class="fc" id="L813">        setParameter(name, new String[] { value });</span>
<span class="fc" id="L814">    }</span>

    /**
     * Sets the multiple values of a parameter in this form. This is generally used when there are multiple controls
     * with the same name in the form.
     *
     * @param name
     *            the name
     * @param values
     *            the values
     */
    @Override
    public void setParameter(String name, final String[] values) {
<span class="fc" id="L827">        FormParameter parameter = getParameter(name);</span>
<span class="fc bfc" id="L828" title="All 2 branches covered.">        if (parameter.isUnknown()) {</span>
<span class="fc" id="L829">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc bfc" id="L831" title="All 2 branches covered.">        if (parameter.isFileParameter()) {</span>
<span class="fc bfc" id="L832" title="All 2 branches covered.">            if (values != NO_VALUES) {</span>
<span class="fc" id="L833">                throw new InvalidFileParameterException(name, values);</span>
            }
<span class="fc" id="L835">            parameter.setFiles(new UploadFileSpec[0]);</span>
        } else {
<span class="fc" id="L837">            parameter.setValues(values);</span>
        }

<span class="fc" id="L840">    }</span>

    /**
     * Sets the multiple values of a file upload parameter in a web request.
     **/
    @Override
    public void setParameter(String name, UploadFileSpec[] files) {
<span class="fc" id="L847">        FormParameter parameter = getParameter(name);</span>
<span class="pc bpc" id="L848" title="1 of 4 branches missed.">        if (parameter == null || !parameter.isFileParameter()) {</span>
<span class="fc" id="L849">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc" id="L851">        parameter.setFiles(files);</span>
<span class="fc" id="L852">    }</span>

    /**
     * Sets the single value of a file upload parameter in this form. A more convenient way to do this than using
     * {@link #setParameter(String,com.meterware.httpunit.protocol.UploadFileSpec[])}
     *
     * @param name
     *            the name
     * @param file
     *            the file
     */
    public void setParameter(String name, File file) {
<span class="fc" id="L864">        setParameter(name, new UploadFileSpec[] { new UploadFileSpec(file) });</span>
<span class="fc" id="L865">    }</span>

    /**
     * Toggles the value of the specified checkbox parameter.
     *
     * @param name
     *            the name of the checkbox parameter
     *
     * @throws IllegalArgumentException
     *             if the specified parameter is not a checkbox or there is more than one control with that name.
     */
    public void toggleCheckbox(String name) {
<span class="fc" id="L877">        FormParameter parameter = getParameter(name);</span>
<span class="pc bpc" id="L878" title="1 of 2 branches missed.">        if (parameter == null) {</span>
<span class="nc" id="L879">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc" id="L881">        parameter.toggleCheckbox();</span>
<span class="fc" id="L882">    }</span>

    /**
     * Toggles the value of the specified checkbox parameter.
     *
     * @param name
     *            the name of the checkbox parameter
     * @param value
     *            of the checkbox parameter
     *
     * @throws IllegalArgumentException
     *             if the specified parameter is not a checkbox or if there is no checkbox with the specified name and
     *             value.
     */
    public void toggleCheckbox(String name, String value) {
<span class="fc" id="L897">        FormParameter parameter = getParameter(name);</span>
<span class="pc bpc" id="L898" title="1 of 2 branches missed.">        if (parameter == null) {</span>
<span class="nc" id="L899">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc" id="L901">        parameter.toggleCheckbox(value);</span>
<span class="fc" id="L902">    }</span>

    /**
     * Sets the value of the specified checkbox parameter.
     *
     * @param name
     *            the name of the checkbox parameter
     * @param state
     *            the new state of the checkbox
     *
     * @throws IllegalArgumentException
     *             if the specified parameter is not a checkbox or there is more than one control with that name.
     */
    public void setCheckbox(String name, boolean state) {
<span class="fc" id="L916">        FormParameter parameter = getParameter(name);</span>
<span class="pc bpc" id="L917" title="1 of 2 branches missed.">        if (parameter == null) {</span>
<span class="nc" id="L918">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc" id="L920">        parameter.setValue(state);</span>
<span class="fc" id="L921">    }</span>

    /**
     * Sets the value of the specified checkbox parameter.
     *
     * @param name
     *            the name of the checkbox parameter
     * @param value
     *            of the checkbox parameter
     * @param state
     *            the new state of the checkbox
     *
     * @throws IllegalArgumentException
     *             if the specified parameter is not a checkbox or if there is no checkbox with the specified name and
     *             value.
     */
    public void setCheckbox(String name, String value, boolean state) {
<span class="fc" id="L938">        FormParameter parameter = getParameter(name);</span>
<span class="pc bpc" id="L939" title="1 of 2 branches missed.">        if (parameter == null) {</span>
<span class="nc" id="L940">            throw new NoSuchParameterException(name);</span>
        }
<span class="fc" id="L942">        parameter.setValue(value, state);</span>
<span class="fc" id="L943">    }</span>

    /**
     * Scriptable implementation for the WebForm.
     */
    public class Scriptable extends HTMLElementScriptable implements NamedDelegate, IdentifiedDelegate, FormScriptable {

        /**
         * Gets the action.
         *
         * @return the action
         */
        public String getAction() {
<span class="fc" id="L956">            return WebForm.this.getAction();</span>
        }

        @Override
        public void setAction(String newAction) {
<span class="fc" id="L961">            setDestination(newAction);</span>
<span class="fc" id="L962">            _presetParameters = null;</span>
<span class="fc" id="L963">        }</span>

        /**
         * Submit.
         *
         * @throws IOException
         *             Signals that an I/O exception has occurred.
         * @throws SAXException
         *             the SAX exception
         */
        public void submit() throws IOException, SAXException {
<span class="fc" id="L974">            submitRequest(getScriptedSubmitRequest());</span>
<span class="fc" id="L975">        }</span>

        /**
         * Reset.
         *
         * @throws IOException
         *             Signals that an I/O exception has occurred.
         * @throws SAXException
         *             the SAX exception
         */
        public void reset() throws IOException, SAXException {
<span class="fc" id="L986">            resetControls();</span>
<span class="fc" id="L987">        }</span>

        /**
         * return the name of the WebForm
         *
         * @return the name
         */
        @Override
        public String getName() {
<span class="fc bfc" id="L996" title="All 2 branches covered.">            return WebForm.this.getName().length() != 0 ? WebForm.this.getName() : WebForm.this.getID();</span>
        }

        /**
         * return the id of the WebForm
         *
         * @return the id
         */
        @Override
        public String getID() {
<span class="fc" id="L1006">            return WebForm.this.getID();</span>
        }

        /**
         * get the Object for the given propertyName
         *
         * @param propertyName
         *            - the name of the property to get
         *
         * @return the Object for the property
         */
        @Override
        public Object get(String propertyName) {
<span class="fc bfc" id="L1019" title="All 2 branches covered.">            if (propertyName.equals(&quot;target&quot;)) {</span>
<span class="fc" id="L1020">                return getTarget();</span>
            }
<span class="fc bfc" id="L1022" title="All 2 branches covered.">            if (propertyName.equals(&quot;action&quot;)) {</span>
<span class="fc" id="L1023">                return getAction();</span>
            }
<span class="fc bfc" id="L1025" title="All 2 branches covered.">            if (propertyName.equals(&quot;length&quot;)) {</span>
<span class="fc" id="L1026">                return Integer.valueOf(getFormControls().length);</span>
            }
<span class="fc" id="L1028">            final FormParameter parameter = getParameter(propertyName);</span>
<span class="fc bfc" id="L1029" title="All 2 branches covered.">            if (!parameter.isUnknown()) {</span>
<span class="fc" id="L1030">                return parameter.getScriptableObject();</span>
            }
<span class="fc" id="L1032">            FormControl control = getControlWithID(propertyName);</span>
<span class="fc bfc" id="L1033" title="All 2 branches covered.">            return control == null ? super.get(propertyName) : control.getScriptingHandler();</span>
        }

        /**
         * Sets the value of the named property. Will throw a runtime exception if the property does not exist or cannot
         * accept the specified value.
         *
         * @param propertyName
         *            - the name of the property
         * @param value
         *            - the new value
         **/
        @Override
        public void set(String propertyName, Object value) {
<span class="fc bfc" id="L1047" title="All 2 branches covered.">            if (propertyName.equals(&quot;target&quot;)) {</span>
<span class="fc" id="L1048">                setTargetAttribute(value.toString());</span>
<span class="fc bfc" id="L1049" title="All 2 branches covered.">            } else if (propertyName.equals(&quot;action&quot;)) {</span>
<span class="fc" id="L1050">                setAction(value.toString());</span>
<span class="fc bfc" id="L1051" title="All 2 branches covered.">            } else if (propertyName.equals(&quot;name&quot;)) {</span>
<span class="fc" id="L1052">                getElement().setAttribute(&quot;name&quot;, value.toString());</span>
<span class="pc bpc" id="L1053" title="1 of 2 branches missed.">            } else if (value instanceof String) {</span>
<span class="nc" id="L1054">                setParameterValue(propertyName, (String) value);</span>
<span class="pc bpc" id="L1055" title="1 of 2 branches missed.">            } else if (value instanceof Number) {</span>
<span class="fc" id="L1056">                setParameterValue(propertyName, HttpUnitUtils.trimmedValue((Number) value));</span>
            } else {
<span class="nc" id="L1058">                super.set(propertyName, value);</span>
            }
<span class="fc" id="L1060">        }</span>

        @Override
        public void setParameterValue(String name, String value) {
<span class="fc" id="L1064">            final Object scriptableObject = getParameter(name).getScriptableObject();</span>
<span class="pc bpc" id="L1065" title="1 of 2 branches missed.">            if (scriptableObject instanceof ScriptableDelegate) {</span>
<span class="fc" id="L1066">                ((ScriptableDelegate) scriptableObject).set(&quot;value&quot;, value);</span>
<span class="nc bnc" id="L1067" title="All 2 branches missed.">            } else if (scriptableObject instanceof ScriptableDelegate[]) {</span>
<span class="nc" id="L1068">                ((ScriptableDelegate[]) scriptableObject)[0].set(&quot;value&quot;, value);</span>
            }
<span class="fc" id="L1070">        }</span>

        /**
         * Gets the element delegates.
         *
         * @return the element delegates
         */
        public ScriptableDelegate[] getElementDelegates() {
<span class="fc" id="L1078">            FormControl[] controls = getFormControls();</span>
<span class="fc" id="L1079">            ScriptableDelegate[] result = new ScriptableDelegate[controls.length];</span>
<span class="fc bfc" id="L1080" title="All 2 branches covered.">            for (int i = 0; i &lt; result.length; i++) {</span>
<span class="fc" id="L1081">                result[i] = (ScriptableDelegate) controls[i].getScriptingHandler();</span>
            }
<span class="fc" id="L1083">            return result;</span>
        }

        /**
         * Gets the elements by tag name.
         *
         * @param name
         *            the name
         *
         * @return the elements by tag name
         *
         * @throws SAXException
         *             the SAX exception
         */
        public ScriptableDelegate[] getElementsByTagName(String name) throws SAXException {
<span class="fc" id="L1098">            return getDelegates(getHTMLPage().getElementsByTagName(getElement(), name));</span>
        }

        /**
         * Instantiates a new scriptable.
         */
<span class="fc" id="L1104">        Scriptable() {</span>
<span class="fc" id="L1105">            super(WebForm.this);</span>
<span class="fc" id="L1106">        }</span>
    }

    // ---------------------------------- package members
    // --------------------------------

    /**
     * Contructs a web form given the URL of its source page and the DOM extracted from that page.
     *
     * @param response
     *            the response
     * @param baseURL
     *            the base URL
     * @param node
     *            the node
     * @param frame
     *            the frame
     * @param defaultTarget
     *            the default target
     * @param characterSet
     *            the character set
     * @param registry
     *            the registry
     */
    WebForm(WebResponse response, URL baseURL, Node node, FrameSelector frame, String defaultTarget,
            String characterSet, ElementRegistry registry) {
<span class="fc" id="L1132">        super(response, node, baseURL, &quot;action&quot;, frame, defaultTarget);</span>
<span class="fc" id="L1133">        _characterSet = characterSet;</span>
<span class="fc" id="L1134">        _registry = registry;</span>
<span class="fc" id="L1135">        _domElement = (HTMLFormElement) node;</span>
<span class="fc" id="L1136">    }</span>

    /**
     * Returns the form control which is part of this form with the specified ID.
     *
     * @param id
     *            the id
     *
     * @return the control with ID
     */
    public FormControl getControlWithID(String id) {
<span class="fc" id="L1147">        FormControl[] controls = getFormControls();</span>
<span class="fc bfc" id="L1148" title="All 2 branches covered.">        for (FormControl control : controls) {</span>
<span class="fc bfc" id="L1149" title="All 2 branches covered.">            if (control.getID().equals(id)) {</span>
<span class="fc" id="L1150">                return control;</span>
            }
        }
<span class="fc" id="L1153">        return null;</span>
    }

    // ---------------------------------- private members
    // --------------------------------

    /**
     * Gets the default button.
     *
     * @return the default button
     */
    private SubmitButton getDefaultButton() {
<span class="fc bfc" id="L1165" title="All 2 branches covered.">        if (getSubmitButtons().length == 1) {</span>
<span class="fc" id="L1166">            return getSubmitButtons()[0];</span>
        }
<span class="fc" id="L1168">        return getSubmitButton(&quot;&quot;);</span>
    }

    /**
     * get the list of submit buttons - will always contain at least one button - if the original list has none a faked
     * submit button will be added.
     *
     * @return a list with the submit buttons
     */
    private List&lt;SubmitButton&gt; getSubmitButtonVector() {
<span class="fc bfc" id="L1178" title="All 2 branches covered.">        if (_buttonVector == null) {</span>
<span class="fc" id="L1179">            _buttonVector = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1180">            FormControl[] controls = getFormControls();</span>
<span class="fc bfc" id="L1181" title="All 2 branches covered.">            for (FormControl control : controls) {</span>
<span class="fc bfc" id="L1182" title="All 2 branches covered.">                if (control instanceof SubmitButton) {</span>
<span class="fc" id="L1183">                    SubmitButton sb = (SubmitButton) control;</span>
<span class="fc" id="L1184">                    sb.rememberEnableState();</span>
<span class="fc" id="L1185">                    _buttonVector.add(sb);</span>
                }
            }

            /**
             * make sure that there is always at least one submit button if none is in the list add a faked one
             */
<span class="fc bfc" id="L1192" title="All 2 branches covered.">            if (_buttonVector.isEmpty()) {</span>
<span class="fc" id="L1193">                _buttonVector.add(SubmitButton.createFakeSubmitButton(this));</span>
            }
        }
<span class="fc" id="L1196">        return _buttonVector;</span>
    }

    /**
     * Gets the preset parameters.
     *
     * @return the preset parameters
     */
    private FormControl[] getPresetParameters() {
<span class="fc bfc" id="L1205" title="All 2 branches covered.">        if (_presetParameters == null) {</span>
<span class="fc" id="L1206">            _presets = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1207">            loadDestinationParameters();</span>
<span class="fc" id="L1208">            _presetParameters = (FormControl[]) _presets.toArray(new FormControl[_presets.size()]);</span>
        }
<span class="fc" id="L1210">        return _presetParameters;</span>
    }

    /**
     * New form control.
     *
     * @param child
     *            the child
     *
     * @return the form control
     */
    FormControl newFormControl(Node child) {
<span class="fc" id="L1222">        return FormControl.newFormParameter(this, child);</span>
    }

    /**
     * Returns an array of form parameter attributes for this form.
     *
     * @return the form controls
     */
    private FormControl[] getFormControls() {
<span class="fc" id="L1231">        HTMLCollection controlElements = _domElement.getElements();</span>
<span class="fc" id="L1232">        FormControl[] controls = new FormControl[controlElements.getLength()];</span>
<span class="fc bfc" id="L1233" title="All 2 branches covered.">        for (int i = 0; i &lt; controls.length; i++) {</span>
<span class="fc" id="L1234">            controls[i] = getControlForNode(controlElements.item(i));</span>
        }
<span class="fc" id="L1236">        return controls;</span>
    }

    /**
     * Gets the control for node.
     *
     * @param node
     *            the node
     *
     * @return the control for node
     */
    private FormControl getControlForNode(Node node) {
<span class="pc bpc" id="L1248" title="1 of 2 branches missed.">        if (_registry.hasNode(node)) {</span>
<span class="fc" id="L1249">            return (FormControl) _registry.getRegisteredElement(node);</span>
        }
<span class="nc" id="L1251">        return (FormControl) _registry.registerElement(node, newFormControl(node));</span>
    }

    /**
     * get the form parameter with the given name.
     *
     * @param name
     *            the name
     *
     * @return the form parameter with this name
     */
    public FormParameter getParameter(String name) {
<span class="fc" id="L1263">        final FormParameter parameter = (FormParameter) getFormParameters().get(name);</span>
<span class="fc bfc" id="L1264" title="All 2 branches covered.">        return parameter != null ? parameter : FormParameter.getUNKNOWN_PARAMETER();</span>
    }

    /**
     * Returns a map of parameter name to form parameter objects. Each form parameter object represents the set of form
     * controls with a particular name. Unnamed parameters are ignored.
     *
     * @return the form parameters
     */
    private Map getFormParameters() {
<span class="fc" id="L1274">        Map formParameters = new HashMap&lt;&gt;();</span>
<span class="fc" id="L1275">        loadFormParameters(formParameters, getPresetParameters());</span>
<span class="fc" id="L1276">        loadFormParameters(formParameters, getFormControls());</span>
<span class="fc" id="L1277">        return formParameters;</span>
    }

    /**
     * Load form parameters.
     *
     * @param formParameters
     *            the form parameters
     * @param controls
     *            the controls
     */
    private void loadFormParameters(Map formParameters, FormControl[] controls) {
<span class="fc bfc" id="L1289" title="All 2 branches covered.">        for (FormControl control : controls) {</span>
<span class="fc bfc" id="L1290" title="All 2 branches covered.">            if (control.getName().isEmpty()) {</span>
<span class="fc" id="L1291">                continue;</span>
            }
<span class="fc" id="L1293">            FormParameter parameter = (FormParameter) formParameters.get(control.getName());</span>
<span class="fc bfc" id="L1294" title="All 2 branches covered.">            if (parameter == null) {</span>
<span class="fc" id="L1295">                parameter = new FormParameter();</span>
<span class="fc" id="L1296">                formParameters.put(control.getName(), parameter);</span>
            }
<span class="fc" id="L1298">            parameter.addControl(control);</span>
        }
<span class="fc" id="L1300">    }</span>

    static {
<span class="fc" id="L1303">        MATCH_NAME = (htmlElement, criteria) -&gt; HttpUnitUtils.matches(((WebForm) htmlElement).getName(),</span>
                (String) criteria);

<span class="fc" id="L1306">    }</span>

    // ===========================---===== exception class
    // NoSuchParameterException =========================================

    /**
     * This exception is thrown on an attempt to set a file parameter to a non file type.
     */
    class InvalidFileParameterException extends IllegalRequestParameterException {

        /** The Constant serialVersionUID. */
        private static final long serialVersionUID = 1L;

        /**
         * construct a new InvalidFileParameterException for the given parameter name and value list.
         *
         * @param parameterName
         *            the parameter name
         * @param values
         *            the values
         */
<span class="fc" id="L1327">        InvalidFileParameterException(String parameterName, String[] values) {</span>
<span class="fc" id="L1328">            _parameterName = parameterName;</span>
<span class="fc" id="L1329">            _values = values;</span>
<span class="fc" id="L1330">        }</span>

        /**
         * get the message for this exception
         */
        @Override
        public String getMessage() {
<span class="fc" id="L1337">            StringBuilder valueList = new StringBuilder();</span>
<span class="fc" id="L1338">            String delim = &quot;&quot;;</span>
<span class="fc bfc" id="L1339" title="All 2 branches covered.">            for (String _value : _values) {</span>
<span class="fc" id="L1340">                valueList.append(delim).append(&quot;'&quot;).append(_value).append(&quot;'&quot;);</span>
<span class="fc" id="L1341">                delim = &quot;, &quot;;</span>
            }
<span class="fc" id="L1343">            return &quot;The file parameter with the name '&quot; + _parameterName</span>
<span class="fc" id="L1344">                    + &quot;' must have type File but the string values &quot; + valueList.append(&quot; where supplied&quot;).toString();</span>
        }

        /** The parameter name. */
        private String _parameterName;

        /** The values. */
        private String[] _values;
    }

    /**
     * This exception is thrown on an attempt to set a parameter to a value not permitted to it by the form.
     **/
    class NoSuchParameterException extends IllegalRequestParameterException {

        /** The Constant serialVersionUID. */
        private static final long serialVersionUID = 1L;

        /**
         * Instantiates a new no such parameter exception.
         *
         * @param parameterName
         *            the parameter name
         */
<span class="fc" id="L1368">        NoSuchParameterException(String parameterName) {</span>
<span class="fc" id="L1369">            _parameterName = parameterName;</span>
<span class="fc" id="L1370">        }</span>

        @Override
        public String getMessage() {
<span class="fc" id="L1374">            return &quot;No parameter named '&quot; + _parameterName + &quot;' is defined in the form&quot;;</span>
        }

        /** The parameter name. */
        private String _parameterName;

    }

    // ============================= exception class
    // IllegalUnnamedSubmitButtonException
    // ======================================

    /**
     * This exception is thrown on an attempt to define a form request with a button not defined on that form.
     **/
    class IllegalUnnamedSubmitButtonException extends IllegalRequestParameterException {

        /** The Constant serialVersionUID. */
        private static final long serialVersionUID = 1L;

        /**
         * Instantiates a new illegal unnamed submit button exception.
         */
<span class="fc" id="L1397">        IllegalUnnamedSubmitButtonException() {</span>
<span class="fc" id="L1398">        }</span>

        @Override
        public String getMessage() {
<span class="nc" id="L1402">            return &quot;This form has more than one submit button, none unnamed. You must specify the button to be used.&quot;;</span>
        }

    }

    // ============================= exception class
    // IllegalSubmitButtonException ======================================

    /**
     * This exception is thrown on an attempt to define a form request with a button not defined on that form.
     **/
    class IllegalSubmitButtonException extends IllegalRequestParameterException {

        /** The Constant serialVersionUID. */
        private static final long serialVersionUID = 1L;

        /**
         * Instantiates a new illegal submit button exception.
         *
         * @param button
         *            the button
         */
<span class="fc" id="L1424">        IllegalSubmitButtonException(SubmitButton button) {</span>
<span class="fc" id="L1425">            _name = button.getName();</span>
<span class="fc" id="L1426">            _value = button.getValue();</span>
<span class="fc" id="L1427">        }</span>

        /**
         * Instantiates a new illegal submit button exception.
         *
         * @param name
         *            the name
         * @param value
         *            the value
         */
<span class="fc" id="L1437">        IllegalSubmitButtonException(String name, String value) {</span>
<span class="fc" id="L1438">            _name = name;</span>
<span class="fc" id="L1439">            _value = value;</span>
<span class="fc" id="L1440">        }</span>

        @Override
        public String getMessage() {
<span class="nc" id="L1444">            return &quot;Specified submit button (name=\&quot;&quot; + _name + &quot;\&quot; value=\&quot;&quot; + _value + &quot;\&quot;) not part of this form.&quot;;</span>
        }

        /** The name. */
        private String _name;

        /** The value. */
        private String _value;

    }

    // ============================= exception class
    // IllegalUnnamedSubmitButtonException
    // ======================================

}

// ========================================== class PresetFormParameter
// =================================================

class PresetFormParameter extends FormControl {

    PresetFormParameter(WebForm form, String name, String value) {
<span class="fc" id="L1467">        super(form);</span>
<span class="fc" id="L1468">        _name = name;</span>
<span class="fc" id="L1469">        _value = value;</span>
<span class="fc" id="L1470">    }</span>

    /**
     * Returns the name of this control..
     **/
    @Override
    public String getName() {
<span class="fc" id="L1477">        return _name;</span>
    }

    /**
     * Returns true if this control is read-only.
     **/
    @Override
    public boolean isReadOnly() {
<span class="nc" id="L1485">        return true;</span>
    }

    /**
     * Returns true if this control accepts free-form text.
     **/
    @Override
    public boolean isTextControl() {
<span class="nc" id="L1493">        return true;</span>
    }

    /**
     * Remove any required values for this control from the list, throwing an exception if they are missing.
     **/
    @Override
    void claimRequiredValues(List values) {
<span class="nc bnc" id="L1501" title="All 2 branches missed.">        if (_value != null) {</span>
<span class="nc" id="L1502">            claimValueIsRequired(values, _value);</span>
        }
<span class="nc" id="L1504">    }</span>

    @Override
    public String getType() {
<span class="nc" id="L1508">        return UNDEFINED_TYPE;</span>
    }

    /**
     * Returns the current value(s) associated with this control. These values will be transmitted to the server if the
     * control is 'successful'.
     **/
    @Override
    public String[] getValues() {
<span class="nc bnc" id="L1517" title="All 2 branches missed.">        if (_values == null) {</span>
<span class="nc" id="L1518">            _values = new String[] { _value };</span>
        }
<span class="nc" id="L1520">        return _values;</span>
    }

    @Override
    protected void addValues(ParameterProcessor processor, String characterSet) throws IOException {
<span class="fc" id="L1525">        processor.addParameter(_name, _value, characterSet);</span>
<span class="fc" id="L1526">    }</span>

    private String _name;
    private String _value;
    private String[] _values;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>